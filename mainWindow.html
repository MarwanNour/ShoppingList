<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Shopping List</title>
</head>

<body>
    <h1>Shopping List</h1>

    <button id="refresh">Refresh Page</button>

    <ul>
    </ul>



</body>

<script>
    const electron = require('electron');
    const { ipcRenderer } = electron;
    const ul = document.querySelector('ul');
    const refreshBtn = document.querySelector('#refresh');

    // Add item
    ipcRenderer.on('item:add', function (e, item) {
        const li = document.createElement('li');
        const itemText = document.createTextNode(item);
        li.appendChild(itemText);
        ul.appendChild(li);
    });

    // Clear item
    ipcRenderer.on('item:clear', function () {
        ul.innerHTML = '';
    });

    // Remove item
    ul.addEventListener('dblclick', removeItem);

    function removeItem(e) {
        e.target.remove();
    }

    /* CONNECT TO DB */
    const mysql = require("mysql");
    const connection = mysql.createConnection({
        host: 'localhost',
        user: 'root',
        password: '',
        database: 'shopping_electron',
        port: 3308
    });
    
    connection.connect();
    
    function getItems() {
        /* GET ITEMS FROM DB */
        
        $cartQuery = "SELECT * FROM cart WHERE 1";
        connection.query($cartQuery, function (error, results, fields) {
            if (error) {
                console.log(error.code);
            } else {
                // console.log("IT WORKS");
                // console.log(results);

                for (let index = 0; index < results.length; index++) {
                    const element = results[index];
                    console.log(element);
                    const li = document.createElement('li');
                    const itemText = document.createTextNode(element.item_name);
                    li.appendChild(itemText);
                    ul.appendChild(li);
                }

            }
        });
        // connection.end();
    }
    refreshBtn.addEventListener('click', function(){
        // Clear the list
        ul.innerHTML = '';
        // Re-add the items in the list
        getItems();
    });


</script>

</html>